# ストリーミング生成の変更点（概要）

高世代の L-System を扱う際に「描画まで時間がかかる」「メモリ消費が急増して止まる」問題を緩和するため、生成処理を段階的に実行しつつ途中経過を UI に反映する仕組みに改修しました。主な変更点は以下のとおりです。

## 文字列生成の非同期化（`frontend/src/l-system.ts`）
- `generateLSystemString` を `async` 化し、各世代ごとにコールバック（`onGeneration`）を挟めるようにしました。
- 文字列を書き換えるたびに `await onGeneration?.(世代, 現在の文字列)` を呼び出せるため、長い世代を生成中でも途中経過を UI に流すことができます。

## 段階的な描画と計測（`frontend/src/regenerator.ts`）
- `regenerate` 内で世代数を見て、7 世代目以降は 2 世代おきに途中描画を行うように設定（`streamingStartGen` / `streamingStep`）。
- 生成コールバック内で
  - 現在の文字列長と進捗を UI に反映。
  - 対象世代なら `renderFromString` を呼び出し、部分的なジオメトリを都度生成して表示。
  - 文字列が大きい場合は `requestAnimationFrame` 相当の待ちを入れ、メインスレッドを一時解放。
- `renderFromString` で既存メッシュをリセットし、枝・葉・花・つぼみのインスタンス化をまとめて行い、必要に応じてメトリクス（文字列長、生成時間など）を計測して UI/コンソールへ出力します。

これにより、重い世代でも途中経過が段階的に表示され、フリーズやメモリ急増を抑えつつ最終描画にたどり着きやすくなりました。
